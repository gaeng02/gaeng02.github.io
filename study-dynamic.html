<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study - Gaeng02</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/components.css">
    <script src="../js/main.js" defer></script>
    <script src="../js/theme.js" defer></script>
    <script src="../js/search.js" defer></script>
    <script src="../js/category-loader.js" defer></script>
    <script defer>
        document.addEventListener('DOMContentLoaded', function() {
            // URL 파라미터에서 카테고리와 서브카테고리 정보 추출
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category');
            const subcategory = urlParams.get('subcategory');
            
            console.log('URL 파라미터:', { category, subcategory });
            
            // 네비게이션 드롭다운 초기화 (Study만)
            window.categoryLoader.initializePage('study', null, '#studyDropdownMenu');
            
            if (category && subcategory) {
                // 서브카테고리 페이지: 해당 폴더의 마크다운 파일들 표시
                console.log('서브카테고리 파일 로드 시작:', category, subcategory);
                loadSubcategoryFiles(category, subcategory);
            } else if (category) {
                // 카테고리 페이지: 해당 카테고리의 서브카테고리들 표시
                console.log('카테고리 서브카테고리 로드 시작:', category);
                loadCategorySubcategories(category);
            } else {
                // 메인 Study 페이지: 모든 카테고리 표시
                console.log('메인 Study 페이지로 리다이렉트');
                loadMainCategories();
            }
        });
        
        function loadSubcategoryFiles(category, subcategory) {
            // 페이지 제목 업데이트
            const heroTitle = document.querySelector('.hero-highlight');
            const heroDescription = document.querySelector('.hero-description');
            
            // 카테고리 이름 변환
            const categoryName = getCategoryDisplayName(category);
            const subcategoryName = getSubcategoryDisplayName(subcategory);
            
            heroTitle.textContent = `${categoryName} > ${subcategoryName}`;
            heroDescription.style.display = 'none';
            
            console.log('파일 로드 시작:', category, subcategory);
            
            // 마크다운 파일들 로드
            window.categoryLoader.getSubcategoryFiles(category, subcategory).then(files => {
                console.log('로드된 파일들:', files);
                window.categoryLoader.renderFileCards(files, 'contentGrid');
            }).catch(error => {
                console.error('Error loading files:', error);
                document.getElementById('contentGrid').innerHTML = '<p class="error-message">파일을 불러오는 중 오류가 발생했습니다.</p>';
            });
        }
        
        function loadCategorySubcategories(category) {
            // 페이지 제목 업데이트
            const heroTitle = document.querySelector('.hero-highlight');
            const heroDescription = document.querySelector('.hero-description');
            
            const categoryName = getCategoryDisplayName(category);
            heroTitle.textContent = categoryName;
            heroDescription.textContent = `${categoryName} 카테고리의 서브카테고리들입니다.`;
            
            // 서브카테고리들 로드
            window.categoryLoader.getSubcategories(category).then(subcategories => {
                // 서브카테고리를 카드 형태로 렌더링
                const container = document.getElementById('contentGrid');
                if (!container) return;

                if (subcategories.length === 0) {
                    container.innerHTML = '<p class="no-results">이 카테고리에 서브카테고리가 없습니다.</p>';
                    return;
                }

                const cardsHTML = subcategories.map(sub => `
                    <div class="project-card" onclick="window.location.href='study-dynamic.html?category=${category}&subcategory=${sub.slug}'" style="cursor: pointer;">
                        <div class="project-header">
                            <h3 class="project-title">${sub.name}</h3>
                            <div class="project-meta">서브카테고리</div>
                        </div>
                        <ul class="project-achievements">
                            <li class="project-achievement">${sub.name} 관련 학습 자료들을 확인할 수 있습니다.</li>
                        </ul>
                    </div>
                `).join('');

                container.innerHTML = cardsHTML;
            }).catch(error => {
                console.error('Error loading subcategories:', error);
                document.getElementById('contentGrid').innerHTML = '<p class="error-message">서브카테고리를 불러오는 중 오류가 발생했습니다.</p>';
            });
        }
        
        function loadMainCategories() {
            // 메인 Study 페이지로 리다이렉트
            window.location.href = '../study.html';
        }
        
        function getCategoryDisplayName(category) {
            const categoryMap = {
                'computer-science': 'Computer Science',
                'ai': 'AI',
                'web-development': 'Web Development'
            };
            return categoryMap[category] || category.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }
        
        function getSubcategoryDisplayName(subcategory) {
            return subcategory.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }
    </script>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="nav-container">
                <div class="nav-brand">
                    <a href="../" class="brand-link">
                        <span class="brand-text">Gaeng02</span>
                    </a>
                    <div class="nav-menu">
                        <div class="nav-dropdown">
                            <a href="study-dynamic.html" class="nav-link active">Study</a>
                            <div class="dropdown-menu" id="studyDropdownMenu">
                                <!-- 동적으로 로드됩니다 -->
                            </div>
                        </div>
                        <a href="../post.html" class="nav-link">Post</a>
                    </div>
                </div>

                <div class="nav-actions">
                    <div class="search-container" id="searchContainer">
                        <input type="text" class="search-input" id="searchInput" placeholder="검색어 입력 후 Enter...">
                        <button class="search-close" id="searchClose">✕</button>
                    </div>
                    <button class="theme-toggle" id="themeToggle" aria-label="테마 변경">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </nav>
    </header>



    <main class="main">
        <section class="hero">
            <div class="hero-container">
                <div class="hero-content">
                    <h1 class="hero-title">
                        <span class="hero-highlight">Study</span>
                    </h1>
                    <p class="hero-description">
                        학습한 내용들을 정리한 공간입니다.
                    </p>
                </div>
            </div>
        </section>

        <section class="projects">
            <div class="container">
                <div class="project-grid" id="contentGrid">
                    <!-- 동적으로 로드됩니다 -->
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3 class="footer-title">Gaeng02</h3>
                    <p class="footer-description">
                        개발자로서의 여정을 기록하고 지식을 공유하는 공간입니다.
                    </p>
                    <div class="social-links">
                        <a href="https://github.com/gaeng02" target="_blank" rel="noopener" class="social-link" aria-label="GitHub">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                            </svg>
                        </a>
                        <a href="mailto:contact@gaeng02.dev" class="social-link" aria-label="이메일">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                <polyline points="22,6 12,13 2,6"/>
                            </svg>
                        </a>
                        <a href="https://instagram.com/gaeng02" target="_blank" rel="noopener" class="social-link" aria-label="Instagram">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
                                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/>
                                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/>
                            </svg>
                        </a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4 class="footer-subtitle">Quick Links</h4>
                    <ul class="footer-links">
                        <li><a href="study-dynamic.html">Study</a></li>
                        <li><a href="../post.html">Post</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Gaeng02. All rights reserved.</p>
            </div>
        </div>
    </footer>
</body>
</html>
